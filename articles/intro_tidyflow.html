<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>An introduction to tidyflow • tidyflow</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="An introduction to tidyflow">
<meta property="og:description" content="tidyflow">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tidyflow</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/intro_tidyflow.html">An introduction to tidyflow</a>
    </li>
    <li>
      <a href="../articles/model-with-recipe.html">Fitting a model with a recipe</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/cimentadaj/tidyflow/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="intro_tidyflow_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>An introduction to tidyflow</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/cimentadaj/tidyflow/blob/master/vignettes/intro_tidyflow.Rmd"><code>vignettes/intro_tidyflow.Rmd</code></a></small>
      <div class="hidden name"><code>intro_tidyflow.Rmd</code></div>

    </div>

    
    
<div id="high-level-description" class="section level2">
<h2 class="hasAnchor">
<a href="#high-level-description" class="anchor"></a>High level description</h2>
<p>The workflow in machine learning is very standard and can be summarized in these steps:</p>
<ul>
<li><p>Separate into training/testing</p></li>
<li><p>Feature engineering / Preprocessing</p></li>
<li><p>Cross validation</p></li>
<li><p>Tuning</p></li>
<li><p>Model definition</p></li>
<li><p>Fit model</p></li>
</ul>
<p>Although some of these steps can be exchanged (feature engineering and preprocessing can be done before separating into training/testing), the process is somewhat fixed. For example, you cannot perform tuning before defining a cross-validation resample or evaluate a model without fitting it.</p>
<p><code>tidyflow</code> takes advantage of this fixed order to create a simple and easy interface to the <code>tidymodels</code> ecosystem. <code>tidyflow</code> works by defining steps which are directly mapped to the workflow defined above:</p>
<ul>
<li><p>Separate into training/testing –&gt; <code>plug_split</code></p></li>
<li><p>Feature engineering / Preprocessing –&gt; <code>plug_recipe</code> / <code>plug_formula</code></p></li>
<li><p>Cross validation –&gt; <code>plug_resample</code></p></li>
<li><p>Tuning –&gt; <code>plug_grid</code></p></li>
<li><p>Model definition –&gt; <code>plug_model</code></p></li>
<li><p>Fit a model –&gt; <code>fit</code></p></li>
</ul>
<p>Let’s work out a manual example.</p>
</div>
<div id="example" class="section level2">
<h2 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h2>
<p>Let’s construct a worklow that fits a linear model to <code>mtcars</code> but only on the training data:</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/tidymodels/tidymodels">tidymodels</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/cimentadaj/tidyflow">tidyflow</a></span>)

<span class="kw">tflow</span> <span class="op">&lt;-</span>
  <span class="kw">mtcars</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/tidyflow.html">tidyflow</a></span>(seed = <span class="fl">52131</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/plug_formula.html">plug_formula</a></span>(<span class="kw">mpg</span> <span class="op">~</span> <span class="kw">.</span>) <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/plug_split.html">plug_split</a></span>(<span class="kw">initial_split</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/plug_model.html">plug_model</a></span>(<span class="fu"><a href="https://parsnip.tidymodels.org/reference/linear_reg.html">linear_reg</a></span>() <span class="op">%&gt;%</span> <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html">set_engine</a></span>(<span class="st">"lm"</span>))

<span class="kw">tflow</span>
<span class="co">#&gt; ══ Tidyflow ════════════════════════════════════════════════════════════════════</span>
<span class="co">#&gt; Data: 32 rows x 11 columns</span>
<span class="co">#&gt; Split: initial_split w/ default args</span>
<span class="co">#&gt; Formula: mpg ~ .</span>
<span class="co">#&gt; Resample: None</span>
<span class="co">#&gt; Grid: None</span>
<span class="co">#&gt; Model:</span>
<span class="co">#&gt; Linear Regression Model Specification (regression)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Computational engine: lm</span>
</pre></div>
<p>The output of <code>tflow</code> describes the current workflow definition. You might be wondering, what are these <code>initial_split</code> or <code><a href="https://parsnip.tidymodels.org/reference/linear_reg.html">linear_reg()</a></code> expressions. <code>tidyflow</code> is built upon <code>tidymodels</code> so it works with the core functions of this ecosystem. <code>initial_split</code> is the function that separates the data into training/testing and <code><a href="https://parsnip.tidymodels.org/reference/linear_reg.html">linear_reg()</a></code> is the model definition. With this definition, we can just <code>fit</code> the model:</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="kw">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/generics/man/fit.html">fit</a></span>(<span class="kw">tflow</span>)
<span class="kw">res</span>
<span class="co">#&gt; ══ Tidyflow [trained] ══════════════════════════════════════════════════════════</span>
<span class="co">#&gt; Data: 32 rows x 11 columns</span>
<span class="co">#&gt; Split: initial_split w/ default args</span>
<span class="co">#&gt; Formula: mpg ~ .</span>
<span class="co">#&gt; Resample: None</span>
<span class="co">#&gt; Grid: None</span>
<span class="co">#&gt; Model:</span>
<span class="co">#&gt; Linear Regression Model Specification (regression)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Computational engine: lm </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ══ Results ═════════════════════════════════════════════════════════════════════</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Fitted model:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; stats::lm(formula = ..y ~ ., data = data)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ...</span>
<span class="co">#&gt; and 5 more lines.</span>
</pre></div>
<p>The result of <code>fit</code> is the same <code>tflow</code> but with a fitted model. You might see some of the lines of the output at the bottom of the printout. We can extract the model with <code>pull_tflow_fit</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="fu"><a href="../reference/tidyflow-extractors.html">pull_tflow_fit</a></span>(<span class="kw">res</span>)<span class="op">$</span><span class="kw">fit</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; stats::lm(formula = ..y ~ ., data = data)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt; (Intercept)          cyl         disp           hp         drat           wt  </span>
<span class="co">#&gt;  -3.835e+01    8.429e-01    5.648e-03    6.885e-04    2.681e+00   -4.479e+00  </span>
<span class="co">#&gt;        qsec           vs           am         gear         carb  </span>
<span class="co">#&gt;   3.047e+00   -4.109e+00    2.135e+00    1.200e+00   -3.165e-01</span>
</pre></div>
<p>Now, let’s add a preprocessing step where we normalize all variables:</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="kw">res2</span> <span class="op">&lt;-</span>
  <span class="kw">tflow</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/plug_formula.html">drop_formula</a></span>() <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/plug_recipe.html">plug_recipe</a></span>(<span class="op">~</span> <span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html">recipe</a></span>(<span class="kw">mpg</span> <span class="op">~</span> <span class="kw">.</span>, data = <span class="kw">.x</span>) <span class="op">%&gt;%</span> <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_scale.html">step_scale</a></span>(<span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_predictors</a></span>())) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/generics/man/fit.html">fit</a></span>()

<span class="fu"><a href="../reference/tidyflow-extractors.html">pull_tflow_fit</a></span>(<span class="kw">res2</span>)<span class="op">$</span><span class="kw">fit</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; stats::lm(formula = ..y ~ ., data = data)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt; (Intercept)          cyl         disp           hp         drat           wt  </span>
<span class="co">#&gt;   -38.34680      1.44751      0.75908      0.05288      1.45206     -4.62467  </span>
<span class="co">#&gt;        qsec           vs           am         gear         carb  </span>
<span class="co">#&gt;     5.32065     -2.09136      1.08653      0.88467     -0.56773</span>
</pre></div>
<p><code>tidyflow</code> allows you to recycle the entire flow and drop/replace any parts that you want to. Let’s now add a cross-validation step and fit the model:</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="kw">res3</span> <span class="op">&lt;-</span>
  <span class="kw">res2</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/plug_resample.html">plug_resample</a></span>(<span class="kw">vfold_cv</span>, v = <span class="fl">10</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/generics/man/fit.html">fit</a></span>()

<span class="fu"><a href="../reference/tidyflow-extractors.html">pull_tflow_fit_tuning</a></span>(<span class="kw">res3</span>)
<span class="co">#&gt; # Resampling results</span>
<span class="co">#&gt; # 10-fold cross-validation </span>
<span class="co">#&gt; # A tibble: 10 x 4</span>
<span class="co">#&gt;    splits         id     .metrics         .notes          </span>
<span class="co">#&gt;    &lt;list&gt;         &lt;chr&gt;  &lt;list&gt;           &lt;list&gt;          </span>
<span class="co">#&gt;  1 &lt;split [21/3]&gt; Fold01 &lt;tibble [2 × 3]&gt; &lt;tibble [0 × 1]&gt;</span>
<span class="co">#&gt;  2 &lt;split [21/3]&gt; Fold02 &lt;tibble [2 × 3]&gt; &lt;tibble [0 × 1]&gt;</span>
<span class="co">#&gt;  3 &lt;split [21/3]&gt; Fold03 &lt;tibble [2 × 3]&gt; &lt;tibble [0 × 1]&gt;</span>
<span class="co">#&gt;  4 &lt;split [21/3]&gt; Fold04 &lt;tibble [2 × 3]&gt; &lt;tibble [0 × 1]&gt;</span>
<span class="co">#&gt;  5 &lt;split [22/2]&gt; Fold05 &lt;tibble [2 × 3]&gt; &lt;tibble [0 × 1]&gt;</span>
<span class="co">#&gt;  6 &lt;split [22/2]&gt; Fold06 &lt;tibble [2 × 3]&gt; &lt;tibble [0 × 1]&gt;</span>
<span class="co">#&gt;  7 &lt;split [22/2]&gt; Fold07 &lt;tibble [2 × 3]&gt; &lt;tibble [0 × 1]&gt;</span>
<span class="co">#&gt;  8 &lt;split [22/2]&gt; Fold08 &lt;tibble [2 × 3]&gt; &lt;tibble [0 × 1]&gt;</span>
<span class="co">#&gt;  9 &lt;split [22/2]&gt; Fold09 &lt;tibble [2 × 3]&gt; &lt;tibble [0 × 1]&gt;</span>
<span class="co">#&gt; 10 &lt;split [22/2]&gt; Fold10 &lt;tibble [2 × 3]&gt; &lt;tibble [0 × 1]&gt;</span>
</pre></div>
<p>When a resample has been specified, the final result of <code>fit</code> cannot be a single model as before because the model has been fitted 10 times. Instead it returns the resample object that is usually returned in <code>tidymodels</code>. In the same spirit of <code>pull_tflow_fit</code>, to extract the resample objects, we used <code>pull_tflow_fit_tuning</code>.</p>
<p><code>fit</code> will always return either a model object or a tune/resamples object depending on the <code>tidyflow</code> specification. The rules for what to expect are simple: if there’s a resample specification or a resample specification with tuning parameters, the result will be a resample dataframe, otherwise it will be a model.</p>
<p>All <code>tidymodels</code> helpers to work with resample objects work just as well. For example:</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="kw">res3</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/tidyflow-extractors.html">pull_tflow_fit_tuning</a></span>() <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tune.tidymodels.org/reference/collect_predictions.html">collect_metrics</a></span>()
<span class="co">#&gt; # A tibble: 2 x 5</span>
<span class="co">#&gt;   .metric .estimator  mean     n std_err</span>
<span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1 rmse    standard   4.02     10  0.925 </span>
<span class="co">#&gt; 2 rsq     standard   0.965    10  0.0200</span>
</pre></div>
<p>Resampling is often used within a grid search context, where we want to find the most optimal value for predicting the data. <code>plug_grid</code> allows you to specify the type of grid that you want to use. For example, let’s replace our linear model with a regularized regression, find the most optimal <code>penalty</code> and <code>mixture</code> values using a regular spaced grid of values:</p>
<div class="sourceCode" id="cb7"><pre class="downlit">

<span class="kw">res4</span> <span class="op">&lt;-</span>
  <span class="kw">res3</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/plug_grid.html">plug_grid</a></span>(<span class="kw">grid_regular</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/plug_model.html">replace_model</a></span>(<span class="fu"><a href="https://parsnip.tidymodels.org/reference/linear_reg.html">linear_reg</a></span>(penalty = <span class="fu"><a href="https://tune.tidymodels.org/reference/tune.html">tune</a></span>(), mixture = <span class="fu"><a href="https://tune.tidymodels.org/reference/tune.html">tune</a></span>()) <span class="op">%&gt;%</span> <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html">set_engine</a></span>(<span class="st">"glmnet"</span>)) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/generics/man/fit.html">fit</a></span>()

<span class="kw">res4</span>
<span class="co">#&gt; ══ Tidyflow [tuned] ════════════════════════════════════════════════════════════</span>
<span class="co">#&gt; Data: 32 rows x 11 columns</span>
<span class="co">#&gt; Split: initial_split w/ default args</span>
<span class="co">#&gt; Recipe: available</span>
<span class="co">#&gt; Resample: vfold_cv w/ v = ~10</span>
<span class="co">#&gt; Grid: grid_regular w/ default args</span>
<span class="co">#&gt; Model:</span>
<span class="co">#&gt; Linear Regression Model Specification (regression)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Main Arguments:</span>
<span class="co">#&gt;   penalty = tune()</span>
<span class="co">#&gt;   mixture = tune()</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Computational engine: glmnet </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ══ Results ═════════════════════════════════════════════════════════════════════</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Tuning results: </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; # A tibble: 5 x 4</span>
<span class="co">#&gt;   splits         id     .metrics          .notes          </span>
<span class="co">#&gt;   &lt;list&gt;         &lt;chr&gt;  &lt;list&gt;            &lt;list&gt;          </span>
<span class="co">#&gt; 1 &lt;split [21/3]&gt; Fold01 &lt;tibble [18 × 6]&gt; &lt;tibble [0 × 1]&gt;</span>
<span class="co">#&gt; 2 &lt;split [21/3]&gt; Fold02 &lt;tibble [18 × 6]&gt; &lt;tibble [0 × 1]&gt;</span>
<span class="co">#&gt; 3 &lt;split [21/3]&gt; Fold03 &lt;tibble [18 × 6]&gt; &lt;tibble [0 × 1]&gt;</span>
<span class="co">#&gt; 4 &lt;split [21/3]&gt; Fold04 &lt;tibble [18 × 6]&gt; &lt;tibble [0 × 1]&gt;</span>
<span class="co">#&gt; 5 &lt;split [22/2]&gt; Fold05 &lt;tibble [18 × 6]&gt; &lt;tibble [0 × 1]&gt;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ... and 5 more lines.</span>
</pre></div>
<p>Since we specified a resampling with a grid search, the result will be a resample/tuning object. We can extract it with <code>pull_tflow_fit_tuning</code> and check which are the best tuning values:</p>
<div class="sourceCode" id="cb8"><pre class="downlit">

<span class="kw">res4</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/tidyflow-extractors.html">pull_tflow_fit_tuning</a></span>() <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tune.tidymodels.org/reference/show_best.html">select_best</a></span>(metric = <span class="st">"rmse"</span>)
<span class="co">#&gt; # A tibble: 1 x 3</span>
<span class="co">#&gt;   penalty mixture .config</span>
<span class="co">#&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;  </span>
<span class="co">#&gt; 1       1   0.525 Model6</span>
</pre></div>
<p>At this point, we need to <em>finalize</em> our <code>tidyflow</code>. This means that after figuring out which are the best tuning parameters, we want to train the model with these tuning values on the entire training data. <code>complete_tflow</code> figures out the best tuning values from the resamples object and train the model for you:</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="kw">final_model</span> <span class="op">&lt;-</span>
  <span class="kw">res4</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/complete_tflow.html">complete_tflow</a></span>(metric = <span class="st">"rmse"</span>)

<span class="kw">final_model</span>
<span class="co">#&gt; ══ Tidyflow [trained] ══════════════════════════════════════════════════════════</span>
<span class="co">#&gt; Data: 32 rows x 11 columns</span>
<span class="co">#&gt; Split: initial_split w/ default args</span>
<span class="co">#&gt; Recipe: available</span>
<span class="co">#&gt; Resample: vfold_cv w/ v = ~10</span>
<span class="co">#&gt; Grid: grid_regular w/ default args</span>
<span class="co">#&gt; Model:</span>
<span class="co">#&gt; Linear Regression Model Specification (regression)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Main Arguments:</span>
<span class="co">#&gt;   penalty = 1</span>
<span class="co">#&gt;   mixture = 0.525</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Computational engine: glmnet </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ══ Results ═════════════════════════════════════════════════════════════════════</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Tuning results: </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; # A tibble: 5 x 4</span>
<span class="co">#&gt;   splits         id     .metrics          .notes          </span>
<span class="co">#&gt;   &lt;list&gt;         &lt;chr&gt;  &lt;list&gt;            &lt;list&gt;          </span>
<span class="co">#&gt; 1 &lt;split [21/3]&gt; Fold01 &lt;tibble [18 × 6]&gt; &lt;tibble [0 × 1]&gt;</span>
<span class="co">#&gt; 2 &lt;split [21/3]&gt; Fold02 &lt;tibble [18 × 6]&gt; &lt;tibble [0 × 1]&gt;</span>
<span class="co">#&gt; 3 &lt;split [21/3]&gt; Fold03 &lt;tibble [18 × 6]&gt; &lt;tibble [0 × 1]&gt;</span>
<span class="co">#&gt; 4 &lt;split [21/3]&gt; Fold04 &lt;tibble [18 × 6]&gt; &lt;tibble [0 × 1]&gt;</span>
<span class="co">#&gt; 5 &lt;split [22/2]&gt; Fold05 &lt;tibble [18 × 6]&gt; &lt;tibble [0 × 1]&gt;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ... and 5 more lines.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Fitted model:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:  glmnet::glmnet(x = as.matrix(x), y = y, family = "gaussian",      alpha = ~0.525) </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    Df  %Dev  Lambda</span>
<span class="co">#&gt; 1   0  0.00 10.1100</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ...</span>
<span class="co">#&gt; and 86 more lines.</span>
</pre></div>
<p>One of the advantages of <code>tidyflow</code> is that it was built to work well within the machine learning workflow. To use this model to predict on the training data, you only have to call <code>predict_training</code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="kw">final_model</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/predict-tidyflow.html">predict_training</a></span>()
<span class="co">#&gt; # A tibble: 24 x 12</span>
<span class="co">#&gt;      mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb .pred</span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1  21       6  160    110  3.9   2.62  16.5     0     1     4     4  22.5</span>
<span class="co">#&gt;  2  21       6  160    110  3.9   2.88  17.0     0     1     4     4  22.1</span>
<span class="co">#&gt;  3  21.4     6  258    110  3.08  3.22  19.4     1     0     3     1  21.0</span>
<span class="co">#&gt;  4  18.7     8  360    175  3.15  3.44  17.0     0     0     3     2  17.8</span>
<span class="co">#&gt;  5  18.1     6  225    105  2.76  3.46  20.2     1     0     3     1  20.5</span>
<span class="co">#&gt;  6  14.3     8  360    245  3.21  3.57  15.8     0     0     3     4  15.5</span>
<span class="co">#&gt;  7  24.4     4  147.    62  3.69  3.19  20       1     0     4     2  22.9</span>
<span class="co">#&gt;  8  19.2     6  168.   123  3.92  3.44  18.3     1     0     4     4  19.5</span>
<span class="co">#&gt;  9  17.8     6  168.   123  3.92  3.44  18.9     1     0     4     4  19.6</span>
<span class="co">#&gt; 10  10.4     8  472    205  2.93  5.25  18.0     0     0     3     4  12.6</span>
<span class="co">#&gt; # … with 14 more rows</span>
</pre></div>
<p>Similarly, you can use <code>predict_testing</code>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="kw">final_model</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/predict-tidyflow.html">predict_testing</a></span>()
<span class="co">#&gt; # A tibble: 8 x 12</span>
<span class="co">#&gt;     mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb .pred</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1  22.8     4 108      93  3.85  2.32  18.6     1     1     4     1  26.0</span>
<span class="co">#&gt; 2  22.8     4 141.     95  3.92  3.15  22.9     1     0     4     2  22.7</span>
<span class="co">#&gt; 3  16.4     8 276.    180  3.07  4.07  17.4     0     0     3     3  16.2</span>
<span class="co">#&gt; 4  17.3     8 276.    180  3.07  3.73  17.6     0     0     3     3  16.9</span>
<span class="co">#&gt; 5  15.2     8 276.    180  3.07  3.78  18       0     0     3     3  16.8</span>
<span class="co">#&gt; 6  15.5     8 318     150  2.76  3.52  16.9     0     0     3     2  17.9</span>
<span class="co">#&gt; 7  15.2     8 304     150  3.15  3.44  17.3     0     0     3     2  18.3</span>
<span class="co">#&gt; 8  30.4     4  95.1   113  3.77  1.51  16.9     1     1     5     2  26.7</span>
</pre></div>
<p>These functions are useful because they’re safe: it’s not rare that you mistakenly predict on the testing data thinking it was the training data or that you forget to apply all of the preprocessing on the testing data. The <code>predict_*</code> functions take care of applying all of your preprocessing on either the training or testing data, freeing the user of having to remember all these different things.</p>
<p>Although this brief tutorial walked you through a <code>tidyflow</code> step by step, the richness of <code>tidyflow</code> is that it allows you to express this pipeline very quickly and to iterate as quickly as possible. For example, we can summarize the entire steps from before in a quick and readable expression:</p>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="kw">tflow</span> <span class="op">&lt;-</span>
  <span class="kw">mtcars</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/tidyflow.html">tidyflow</a></span>(seed = <span class="fl">52131</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/plug_recipe.html">plug_recipe</a></span>(<span class="op">~</span> <span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html">recipe</a></span>(<span class="kw">mpg</span> <span class="op">~</span> <span class="kw">.</span>, data = <span class="kw">.x</span>) <span class="op">%&gt;%</span> <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_scale.html">step_scale</a></span>(<span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_predictors</a></span>())) <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/plug_split.html">plug_split</a></span>(<span class="kw">initial_split</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/plug_resample.html">plug_resample</a></span>(<span class="kw">vfold_cv</span>) <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/plug_grid.html">plug_grid</a></span>(<span class="kw">grid_regular</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/plug_model.html">plug_model</a></span>(<span class="fu"><a href="https://parsnip.tidymodels.org/reference/linear_reg.html">linear_reg</a></span>(penalty = <span class="fu"><a href="https://tune.tidymodels.org/reference/tune.html">tune</a></span>(), mixture = <span class="fu"><a href="https://tune.tidymodels.org/reference/tune.html">tune</a></span>()) <span class="op">%&gt;%</span> <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html">set_engine</a></span>(<span class="st">"glmnet"</span>))

<span class="kw">tflow</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/generics/man/fit.html">fit</a></span>() <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/tidyflow-extractors.html">pull_tflow_fit_tuning</a></span>() <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tune.tidymodels.org/reference/collect_predictions.html">collect_metrics</a></span>()
<span class="co">#&gt; # A tibble: 18 x 8</span>
<span class="co">#&gt;         penalty mixture .metric .estimator  mean     n std_err .config</span>
<span class="co">#&gt;           &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;  </span>
<span class="co">#&gt;  1 0.0000000001   0.05  rmse    standard   3.92     10  0.878  Model1 </span>
<span class="co">#&gt;  2 0.0000000001   0.05  rsq     standard   0.964    10  0.0200 Model1 </span>
<span class="co">#&gt;  3 0.00001        0.05  rmse    standard   3.92     10  0.878  Model2 </span>
<span class="co">#&gt;  4 0.00001        0.05  rsq     standard   0.964    10  0.0200 Model2 </span>
<span class="co">#&gt;  5 1              0.05  rmse    standard   2.84     10  0.380  Model3 </span>
<span class="co">#&gt;  6 1              0.05  rsq     standard   0.946    10  0.0448 Model3 </span>
<span class="co">#&gt;  7 0.0000000001   0.525 rmse    standard   3.98     10  0.905  Model4 </span>
<span class="co">#&gt;  8 0.0000000001   0.525 rsq     standard   0.964    10  0.0199 Model4 </span>
<span class="co">#&gt;  9 0.00001        0.525 rmse    standard   3.98     10  0.905  Model5 </span>
<span class="co">#&gt; 10 0.00001        0.525 rsq     standard   0.964    10  0.0199 Model5 </span>
<span class="co">#&gt; 11 1              0.525 rmse    standard   2.83     10  0.430  Model6 </span>
<span class="co">#&gt; 12 1              0.525 rsq     standard   0.944    10  0.0436 Model6 </span>
<span class="co">#&gt; 13 0.0000000001   1     rmse    standard   3.98     10  0.908  Model7 </span>
<span class="co">#&gt; 14 0.0000000001   1     rsq     standard   0.965    10  0.0199 Model7 </span>
<span class="co">#&gt; 15 0.00001        1     rmse    standard   3.98     10  0.908  Model8 </span>
<span class="co">#&gt; 16 0.00001        1     rsq     standard   0.965    10  0.0199 Model8 </span>
<span class="co">#&gt; 17 1              1     rmse    standard   2.85     10  0.383  Model9 </span>
<span class="co">#&gt; 18 1              1     rsq     standard   0.917    10  0.0638 Model9</span>
</pre></div>
<p><code>tidyflow</code> has several advantages:</p>
<ul>
<li><p>You only specify the data once (no need to pass it to the recipe, the split, the cross-validation, the final fitting, the predicting, etc…)</p></li>
<li><p>You provide a seed in the <code>tidyflow</code> and it makes sure the same <code>tidyflow</code> is <strong>always</strong> reproducible</p></li>
<li><p>No need to deal with separate objects (training data, cross-validated set, separate tuning grid, separate recipe)</p></li>
<li><p>No need to remember which <code>fit</code> function to use (<code>fit_resample</code>, <code>tune_grid</code>, <code>fit</code>): <code>fit</code> takes care of that and always returns either a model or a resamples/tune object</p></li>
<li><p>It’s very safe with respect to the training/testing dataset: everything is applied on the training data by default and <code>predict_training</code> and <code>predict_testing</code> make sure that you never have to do predictions manually, avoiding unexpected mistakes.</p></li>
<li><p>You can replace any step with ease. For example, you can build a complex workflow with a particular dataset and simply replace the data with a new data source and execute the <code>tidyflow</code>. In other settings, this means that you have to replace the data slot in the recipe, the split, the cross-validation, etc..</p></li>
</ul>
</div>
<div id="what-is-expected" class="section level2">
<h2 class="hasAnchor">
<a href="#what-is-expected" class="anchor"></a>What is expected?</h2>
<p>All <code>plug_*</code> functions and <code><a href="../reference/tidyflow.html">tidyflow()</a></code> return a <code>tidyflow</code> object. However, what do they accept? The first argument is always a <code>tidyflow</code> and the remaining arguments add the steps used in the analysis. Below is a lookup table of what each accepts:</p>
<ul>
<li><p><code>plug_split</code>: a function to be applied to the data. This is assumed to be a function such as <code>initial_split</code> or similar functions from the <code>rsample</code> package.</p></li>
<li><p><code>plug_formula</code>: the formula of the model definition. A <code>tidyflow</code> needs to specify either a formula or a recipe, <strong>but not both</strong>.</p></li>
<li><p><code>plug_recipe</code>: a formula containing a recipe that will be applied to the training data. A <code>tidyflow</code> needs to specify either a formula or a recipe, <strong>but not both</strong>.</p></li>
<li><p><code>plug_resample</code>: a function to be applied to the preprocessed data. This is assumed to be a function such as <code>vfold_cv</code> or similar functions from the <code>rsample</code> package.</p></li>
<li><p><code>plug_grid</code>: a function to be applied to the tuning placeholders in the recipe or the data. This is assumed to be a function such as <code>grid_regular</code> or similar functions from the <code>dials</code> package.</p></li>
<li><p><code>plug_model</code>: a model object from packages such as <code>parsnip</code>.</p></li>
</ul>
<p>Despite these <code>plug_*</code> not having a single unified interface on which arguments they accept, we believe these <code>plug_*</code> functions are easy to remember as they can be mapped directly to the machine learning workflow. Any feedback on how to improve the interface or functionality is more than welcome. Please file an issue on Github <a href="https://github.com/cimentadaj/tidyflow/issues">here</a>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jorge Cimentada, Davis Vaughan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
